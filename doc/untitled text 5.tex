\section{Position estimation}
To give a better position estimate which can be fed to the controller as well, the different data collected from the sensors mounted are put through a Kalman filter. This filter takes the different measurements as inputs, and uses these to give a better estimate of the position, rather than the quite noisy measurements taken using just the raw \ac{GPS} data. 

To develop such a filter, the model of the ship is to be computed, as well as a mapping of the different inputs and outputs to the system. The model of the forward and sidewards case (surge and sway) are quite easy to model, as these to are quite similar (the only difference being the drag coefficient being quite large for sideways motion). However, the heaving motion is complicated. 

\subsection{Surge and sway motion}
The state model for the surge and sway motion are quite similar, as the two consist of the same formula, but with different coefficients. The general formula for the position can be written as (in the discrete time domain):
\begin{align}
x(n+1) = x(n) + \dot{x}(n)t_s + \ddot{x}(n)\frac{t_s^2}{2}\\
\dot{x}(n+1) = \dot{x}(n) + \ddot{x}(n)t_s\\
\ddot{x}(n+1) = -\dot{x}(n) \cdot \overline{\alpha}_x(n) + \ddot{x}(n)
\end{align}
These formulae represent an estimate of the current position, velocity and acceleration given the previous measurements. As seen the above can be written in a matrix, to ease further computations:
\begin{align}
\begin{bmatrix}
x(n+1)\\
\dot{x}(n+1)\\
\ddot{x}(n+1)
\end{bmatrix} = \begin{bmatrix}
1 & t_s & \frac{t_s^2}{2}\\
0 & 1 & t_s\\
0 & -\overline{\alpha}_x(n) & 1
\end{bmatrix}\begin{bmatrix}
x(n)\\
\dot{x}(n)\\
\ddot{x}(n)
\end{bmatrix}
\label{eq:yn}
\end{align}
However, as the input to the system is given as an acceleration (the parameter that is controllable, given current inputs and measurements) - this can be taken out of the matrix, and inserted into an input vector:
\begin{align}
\vec{u}(n) = \begin{bmatrix}
0\\
0\\
\ddot{x}(n)
\end{bmatrix}
\label{eq:un}
\end{align}
The above equation \vref{eq:yn} combined with \vref{eq:un} describes the total motion forwards, which can be extended to the sideways case as well. To formulas are the same, the only thing that changes, is the drag coefficient. To model the drag coefficient, the drag coefficient can be estimated by:
\begin{align}
F_{drag} = \frac{1}{2}C_D \rho_w A_\text{hull} \dot{x} |\dot{x}|
\end{align}
\noindent Where:
\begin{ffk}
$C_D$ is a drag coefficient\\
$rho_w$ is the density of water\\
$A_hull$ is the cross-sectional area of the hull\\
\end{ffk}
This term is however nonlinear so to do further calculations on it, it would need to be linearized. The Taylor series expansion can be used. This is given as:
\begin{align}
f(x) \approx \overbrace{f(x_0) - \frac{\partial}{\partial x}f(x_0)\cdot x_0}^\text{constant} + \overbrace{\frac{\partial}{\partial x}f(x_0) \cdot x}^\text{variable}
\end{align}
The above represents a first order Taylor expansion and yields a constant and a variable term. The first order expansion of $F_drag$ gives the following expression:
\begin{align}
\overline{\alpha}_x(n) = \mathcal{T}(F_{drag} = \left(\frac{1}{2}C_D \rho_w A_\text{hull} \dot{x}_0^2 \dot{x}_0 - C_D \rho_w A_\text{hull} \dot{x}_0 \right) + (C_D \rho_w A_\text{hull} \dot{x}_0)\dot{x}
\end{align}

\subsection{Heave motion}
The heaving motion of the ship, will not immediatly take effect, as the ship will act as a "spring" when forced to move up, and will oscillate for a while, before it has reached its final position. To map this, a formula describing the forces given by \todo{inds√¶t kilde -rlc} is used. This formula describes the oscillation taking place when the ship is forced to move upwards. 
\begin{align}
\zeta = 2+2
\end{align}